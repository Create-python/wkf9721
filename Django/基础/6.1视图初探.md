怎样实现视图\视图的相关特性以及视图的工作原理等.

###6.1.1定义第一个视图

URL和视图。它们是一一对应的关系，每一个请求对应一个URL，URL映射到具体的视图函数（类），传递HttpRequest，视图处理之后返回HttpResponse。

Django中三种定义URL配置的方法

第一种，针对基于函数的视图：首先将视图定义文件引入（import），然后利用path定义URL和视图的对应关系，这与当前hello_django_bbs视图配置的形式是一样的。需要注意，当前给path函数传递了两个参数，第一个参数定义了URL的匹配规则，第二个参数定义了映射的视图函数，这两个参数都是必填项，在将来会看到path函数还可以接受其他的参数。

![image-20220405205226160](E:\桌面\note\images\image-20220405205226160.png)

第二种，针对基于类的视图：首先将视图类对象引入，之后用类似的方法配置URL和视图类的对应关系。

![image-20220405205309195](E:\桌面\note\images\image-20220405205309195.png)

第三种，针对项目中存在多App的场景：利用include实现App与项目的解耦。include将App的URL配置文件导入，之后就可以实现根据不同的App来分发请求，实现每个App自己管理自己的视图与URL映射，配置管理App的模式。

![image-20220405205437784](E:\桌面\note\images\image-20220405205609409.png)

![image-20220405205326950](E:\桌面\note\images\image-20220405205326950.png)

### 6.1.2 视图的请求与响应对象

1.HttpRequest

HttpRequest对象定义于django/http/request.py文件中，每当请求到来的时候，Django就会创建一个携带有请求元数据的HttpRequest对象，传递给视图函数的第一个参数。

（1）method

method是一个字符串类型的值，标识请求所使用的HTTP方法，例如GET、POST、PUT等。这是最常用到的一个属性，在视图函数中用这个属性判断请求的类型，再给出对应的处理逻辑。

之所以可以这样，是因为Django框架在路由分发时，不会考虑请求所使用的HTTP方法。也就是说，**对于同一个URL，不论是使用GET还是POST都会路由到同一个视图函数去处理。**

对于hello_django_bbs而言，给它添加@csrf_exempt装饰器，用POST方法请求对应的URL，可以获得与GET请求同样的响应

![image-20220405210230247](E:\桌面\note\images\image-20220405210230247.png)

但有时候，可能需要明确只能接受特定的请求方法，Django也对此提供了支持，利用@require_http_methods装饰器指定视图可以接受的方法。例如，只允许hello_django_bbs接受GET和P OST请求，那么，可以这样配置：

![image-20220405210104837](E:\桌面\note\images\image-20220405210104837.png)

当向这个视图发送GET、POST之外的方法时（如PUT），Django将会抛出405错误，并显示如下错误信息：

![image-20220405210143370](E:\桌面\note\images\image-20220405210143370.png)

为了简化使用，Django提供了几个简单的装饰器指定可以接受的请求方法，它们定义于django/views/decorators/http.py文件中，如require_GET只允许GET方法、require_POST只允许POST方法等。

（2）scheme

这是一个被@property装饰的方法，返回字符串类型的值。它可以被当作属性直接调用（request.scheme）。它用来标识请求的协议类型（http或https）。

（3）path

其为字符串类型，返回当前请求页面的路径，但是不包括协议类型（scheme）和域名。例如，对于请求http://127.0.0.1:8000/post/hello/，path返回的是/post/hello/。

（4）GET

这是一个类字典对象，包含GET请求中的所有参数。大多数HTTP请求都会携带有参数，例如，将之前访问的URL修改成http://127.0.0.1:8000/post/hello/?a=1&b=2&c=3，就可以通过GET属性获取到a、b、c三个参数了。GET属性中的键和值都是字符串类型，所以，可能需要对获取到的参数值进行类型转换。通常，获取参数的方法有两种。

①request.GET['a']：这样可以获取到参数a，但是使用这种方式需要确保参数a是存在的，否则会抛出MultiValueDictKeyError错误。

②request.GET.get('d',0)：这种方式尝试从GET属性中获取属性d，获取不到，则返回数字0，与第一种方式相比更加安全。

对于GET属性需要注意，它并不是Python中的字典类型，实际上它是一个QueryDict（django.http.QueryDict）类型的实例，且它是只读的。**如果需要修改它，可以通过copy方法获取它的副本，并在副本上执行修改。**